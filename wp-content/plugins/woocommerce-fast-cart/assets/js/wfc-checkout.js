document.addEventListener("DOMContentLoaded",(()=>{const e=window.parent.FastCart.getSettings(),t=e.debug||!1,o=(...e)=>{t&&(2===parseInt(t)?console.trace(...e):console.log(...e))};if(document.body.classList.contains("wfc-checkout--receipt")){let t=window.location.href;wc_fast_cart_checkout_params&&wc_fast_cart_checkout_params.receiptUrl&&(t=wc_fast_cart_checkout_params.receiptUrl),e&&e.options&&e.options.redirectReceipt&&(t=e.options.redirectReceipt),t=new URL(t),t.searchParams.delete("wfc-checkout"),window.parent.FastCart.completeCheckout(t)}else{window.parent.FastCart.loadCheckout(jQuery("html").height()),jQuery(document).on("click","a",(e=>{const t=e.target.closest("a");let o=t.href;return t.classList.contains("wc-block-components-checkout-return-to-cart-button")||!0===window.parent.FastCart.showCartIfHrefMatches(e)?(window.parent.FastCart.setStatus("loading"),void window.parent.FastCart.refresh(!0)):-1===o.indexOf("#")?(window.parent.FastCart.redirectTo(e.currentTarget.href),e.preventDefault(),e.stopPropagation(),!1):void setTimeout((()=>{window.parent.FastCart.loadCheckout(jQuery("html").height())}),1e3)})),jQuery(document.body).on("click change init_checkout checkout_error update_checkout updated_checkout",(()=>{window.parent.FastCart.loadCheckout(jQuery("html").height()),setTimeout((()=>{window.parent.FastCart.loadCheckout(jQuery("html").height())}),500)})),jQuery(document.body).on("checkout_error",(()=>{window.parent.FastCart.resetScroll()}));const t=document.querySelector("form.woocommerce-checkout, form.wc-block-checkout__form");if(t){new MutationObserver((()=>{setTimeout((()=>{window.parent.FastCart.loadCheckout(jQuery("html").height())}),100)})).observe(t,{attributes:!0,childList:!0,subtree:!0});const e=t.querySelector('input[name="_used_wfc"]')||document.createElement("input");e.type="hidden",e.name="_used_wfc",e.value="true",t.append(e)}if(wc_fast_cart_checkout_params&&wc_fast_cart_checkout_params.autocomplete_api&&"undefined"==typeof google){let e=document.createElement("script");e.type="text/javascript",e.src=`https://maps.googleapis.com/maps/api/js?key=${wc_fast_cart_checkout_params.autocomplete_api}&libraries=places&callback=wfcAutocompleteReady`,document.body.append(e)}let a,c=null;const s=t=>{var a;const c=null!==(a=e.autocomplete)&&void 0!==a?a:{fields:["address_components"],strictBounds:!1},s=t.closest(".woocommerce-billing-fields,.woocommerce-shipping-fields,.wc-block-components-address-form-wrapper").querySelector('select[autocomplete="country"],select[name="billing_country"]');let n;s&&""!==s.value&&(c.componentRestrictions={country:s.value.toLowerCase()}),o("default settings:",c),t.setAttribute("autocomplete","off");try{n=new google.maps.places.Autocomplete(t,c)}catch(e){return o("autocomplete error:",e),void(t.dataset.acInstalled="fail")}t.gmpACListener=n.addListener("place_changed",(e=>{o("place changed",e),r(t,n)})),t.dataset.acInstalled||(jQuery(document.body).on("country_to_state_changing",((e,t)=>{console.log("country changed",e,t),n.setComponentRestrictions({country:t.toLowerCase()})})),document.addEventListener("wc-fast-cart|block_country_changed",(({detail:e})=>{const{addressStore:o,country:a}=e;t.closest(o)&&(n.setComponentRestrictions({country:a.toLowerCase()}),window.FastCart.debug("updated autocomplete country",a,o))}))),t.gmpAC=n,t.dataset.acInstalled="yes",document.dispatchEvent(new CustomEvent("wc-fast-cart|autocomplete_installed",{detail:{addressInput:t,autocomplete:n}}))};document.addEventListener("focus",(e=>{e.target.closest("input")&&"address-line1"===e.target.getAttribute("autocomplete")&&"yes"!==e.target.dataset.acInstalled&&"fail"!==e.target.dataset.acInstalled&&s(e.target)})),window.gm_authFailure=e=>{aciApiStatus="error",o("gm_authFailure",e),document.querySelectorAll(".gm-err-autocomplete").forEach((e=>{e.gmpACListener&&google&&(google.maps.event.removeListener(e.gmpACListener),google.maps.event.clearInstanceListeners(e)),e.disabled=!1,e.dataset.acInstalled="fail",e.autocomplete="street-address",e.placeholder=e.dataset.placeholder,e.style.backgroundImage="",e.focus()}))},window.wfcAutocompleteReady=e=>{if("error"!==c){if(a=document.querySelectorAll('input[autocomplete="address-line1"]'),window.FastCart.debug("found address fields:",a),!a||0===a.length)return window.FastCart.debug("found address fields:",a),window.FastCart.debug("no address fields found, trying again in 500ms"),void setTimeout((()=>{wfcAutocompleteReady(e)}),500);for(let e of a)s(e)}};const r=(e,t)=>{try{let o=t.getPlace();if(!o)return;n(o,e.closest(".wc-block-components-address-form,.woocommerce-billing-fields,.woocommerce-shipping-fields"))}catch(e){o("autocomplete error:",e),window.gm_authFailure()}},n=(e,t)=>{if(t.classList.contains("wc-block-components-address-form"))return void document.dispatchEvent(new CustomEvent("wc-fast-cart|update_checkout_values",{detail:{place:e,addressParent:t}}));let o=t.querySelector('[autocomplete="address-line1"],[name="billing_address_1"],[name="shipping_address_1"]'),a=t.querySelector('[autocomplete="address-line2"],[name="billing_address_2"],[name="shipping_address_2"]'),c=t.querySelector('[autocomplete="address-level2"],[name="billing_city"],[name="shipping_city"]'),s=t.querySelector('#wc-block-components-state-input input,[autocomplete="address-level1"],[name="billing_state"],[name="shipping_state"]'),r=t.querySelector('[autocomplete="postal-code"],[name="billing_postcode"],[name="shipping_postcode"]'),n="",l="";for(const t of e.address_components)switch(t.types[0]){case"street_number":n=`${t.long_name} ${n}`;break;case"route":n+=t.short_name;break;case"postal_code":l=`${t.long_name}${l}`;break;case"postal_code_suffix":l=`${l}-${t.long_name}`;break;case"postal_town":case"locality":if(!c)break;c.value=t.long_name,jQuery(c).change();break;case"administrative_area_level_1":if(!s)break;if("SELECT"===s.tagName){for(let e in s.options)if(s.options[e].value==t.short_name){s.selectedIndex=e,jQuery(s).change();break}}else s.value=t.long_name}o.value=n,r.value=l,jQuery(o).change(),jQuery(r).change(),a&&a.focus()}}}));